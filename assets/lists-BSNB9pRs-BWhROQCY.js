import{E as h,S as y,V as C,s as v,D as c,t as b}from"./index-b3LikYps.js";const x=2,O=()=>b({toDOM:()=>{const e=document.createElement("span");e.className="ink-mde-indent",e.style.width="2rem",e.style.textDecoration="none",e.style.display="inline-flex";const t=document.createElement("span");return t.className="ink-mde-indent-marker",t.innerHTML="&nbsp;",e.appendChild(t),e}}),D=()=>{const e=document.createElement("label");return e.setAttribute("aria-hidden","true"),e.setAttribute("tabindex","-1"),e.className="ink-mde-list-marker",e.style.minWidth="2rem",e},H=e=>b({eq:t=>t.isChecked===e,ignoreEvent:()=>!1,isChecked:e,toDOM:()=>{const t=D(),n=document.createElement("input");return n.setAttribute("aria-hidden","true"),n.setAttribute("tabindex","-1"),n.className="ink-mde-task-marker",n.type="checkbox",n.checked=e,t.classList.add("ink-mde-task"),t.appendChild(n),t}}),N=()=>b({toDOM:()=>{const e=D();return e.setAttribute("inert","true"),e.innerHTML="&bull;",e}}),T=e=>b({toDOM:()=>{const t=D(),n=document.createElement("span");return t.setAttribute("inert","true"),t.appendChild(n),n.setAttribute("aria-hidden","true"),n.setAttribute("tabindex","-1"),n.className="ink-mde-number-marker",n.innerHTML=`${e}`,t}}),w=(e,{from:t,to:n,type:r})=>{if(r.name==="Blockquote")return!1;if(r.name!=="ListMark")return;const i=e.doc.lineAt(t).from,s=e.sliceDoc(t,n),a=t,o=n,d=e.sliceDoc(o,o+1)===" ",l=a-i;if(!d)return;const u=Math.floor(l/x),m=[];for(const f of Array(u).keys()){const p=i+f*x,k=p+x,g=c.replace({widget:O()}).range(p,k);m.push(g)}return{indentLevel:u,indentation:l,lineStart:i,marker:s,markerEnd:o,markerStart:a,spacerDecorations:m}},$=()=>{const e=t=>{const n=[],r=[];return v(t).iterate({enter:i=>{const s=w(t,i);if(!s)return s;const{indentLevel:a,lineStart:o,marker:d,markerEnd:l,markerStart:u,spacerDecorations:m}=s;if(!["-","*"].includes(d))return;const f=c.line({attributes:{class:"ink-mde-list ink-mde-bullet-list",style:`--indent-level: ${a}`}}).range(o);r.push(f),r.push(...m),n.push(...m);const p=l+1,k=c.replace({widget:N()}).range(u,p);r.push(k),n.push(k)}}),[c.set(r,!0),c.set(n,!0)]};return[y.define({create(t){return e(t)},update(t,{state:n}){return e(n)},provide(t){return[h.decorations.of(n=>{const[r,i]=n.state.field(t);return r}),h.atomicRanges.of(n=>{const[r,i]=n.state.field(t);return i})]}})]},j=()=>{const e=t=>{const n=[],r=[];return v(t).iterate({enter:i=>{const s=w(t,i);if(!s)return s;const{indentLevel:a,lineStart:o,marker:d,markerEnd:l,markerStart:u,spacerDecorations:m}=s;if(["-","*"].includes(d))return;const f=c.line({attributes:{class:"ink-mde-list ink-mde-number-list",style:`--indent-level: ${a}`}}).range(o);r.push(f),r.push(...m),n.push(...m);const p=l+1,k=c.replace({widget:T(d)}).range(u,p);r.push(k),n.push(k)}}),[c.set(r,!0),c.set(n,!0)]};return[y.define({create(t){return e(t)},update(t,{state:n}){return e(n)},provide(t){return[h.decorations.of(n=>{const[r,i]=n.state.field(t);return r}),h.atomicRanges.of(n=>{const[r,i]=n.state.field(t);return i})]}})]},q=()=>{const e=r=>{const i=[],s=[];return v(r).iterate({enter:a=>{const o=w(r,a);if(!o)return o;const{indentLevel:d,lineStart:l,marker:u,markerEnd:m,markerStart:f,spacerDecorations:p}=o;if(!["-","*"].includes(u))return;const k=m+1,g=k+3,E=r.sliceDoc(k,g);if(!["[ ]","[x]"].includes(E))return;const A=g+1;if(r.sliceDoc(g,A)!==" ")return;const L=E==="[x]",M=c.line({attributes:{class:`ink-mde-list ink-mde-task-list ${L?"ink-mde-task-checked":"ink-mde-task-unchecked"}`,style:`--indent-level: ${d}`}}).range(l);s.push(M),s.push(...p),i.push(...p);const S=c.replace({widget:H(L)}).range(f,A);s.push(S),i.push(S)}}),[c.set(s,!0),c.set(i,!0)]},t=C.define(()=>({}),{eventHandlers:{mousedown:(r,i)=>{var a;const s=(a=r.target.closest(".ink-mde-list-marker"))==null?void 0:a.querySelector(".ink-mde-task-marker");if(s){const o=i.posAtDOM(s),d=o-4,l=o-1,u=i.state.sliceDoc(d,l);return u==="[ ]"&&i.dispatch({changes:{from:d,to:l,insert:"[x]"}}),u==="[x]"&&i.dispatch({changes:{from:d,to:l,insert:"[ ]"}}),!0}}}}),n=y.define({create(r){return e(r)},update(r,{state:i}){return e(i)},provide(r){return[h.decorations.of(i=>{const[s,a]=i.state.field(r);return s}),h.atomicRanges.of(i=>{const[s,a]=i.state.field(r);return a})]}});return[t,n]},R=e=>[e.task?q():[],e.bullet?$():[],e.number?j():[],h.theme({":where(.ink-mde-indent)":{display:"inline-flex",justifyContent:"center"},":where(.ink-mde-indent-marker)":{borderLeft:"1px solid var(--ink-internal-syntax-processing-instruction-color)",bottom:"0",overflow:"hidden",position:"absolute",top:"0",width:"0"},":where(.ink-mde-list)":{paddingLeft:"calc(var(--indent-level) * 2rem + 2rem) !important",position:"relative",textIndent:"calc((var(--indent-level) * 2rem + 2rem) * -1)"},":where(.ink-mde-list *)":{textIndent:"0"},":where(.ink-mde-list-marker)":{alignItems:"center",color:"var(--ink-internal-syntax-processing-instruction-color)",display:"inline-flex",justifyContent:"center",minWidth:"2rem"},":where(.ink-mde-task-marker)":{cursor:"pointer",margin:"0",scale:"1.2",transformOrigin:"center center"},":where(.ink-mde-task-list.ink-mde-task-checked)":{textDecoration:"line-through",textDecorationColor:"var(--ink-internal-syntax-processing-instruction-color)"}})];export{R as lists};
